#!/usr/bin/env bash
# Chezmoi run_onchange script: Install Fisher and Fish plugins
# fish_plugins hash: {{ include "dot_config/fish/fish_plugins.tmpl" | sha256sum }}
set -euo pipefail

# shellcheck source=/dev/null
source "${CHEZMOI_SOURCE_DIR:-$(chezmoi source-path)}/scripts/lib/common.sh"

ensure_brew_in_path
require_cmd fish

if [[ ! -f ~/.config/fish/fish_plugins ]]; then
    fail "fish_plugins not found"
fi

log "Installing Fisher and plugins..."

# Step 2: Install plugins with normal config (Fisher state persists correctly)
curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | fish
fish -c 'fisher install jorgebucaran/fisher'
fish -c 'fisher update' </dev/null
